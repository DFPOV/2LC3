â€” Assignment 1 Notebook 2: Correctness of `while` Loops
[1]
Preloaded here is:

All propositional logic, including monotonicity laws, and Leibniz as axiom and substitution laws
Integers up to Ex5.1, Ex5.4, and 5.5
Two hint items per hint are allowed here; Evaluation is disabled, but Facts are allowed.

[2]
We continue with command correctness as started in H3 and Ex3.4, and add a new kind of commands: while loops, constructed using the following command constructor:

      while_do_od : ğ”¹ â†’ Cmd â†’ Cmd
[3]
We reason about while loops using the following inference rule:

    Primitive inference rule â€œWhileâ€:
                 `B âˆ§ Q  â‡’â… C â†  Q`
        âŠ¦â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
          `Q  â‡’â… while B do C od â†  Â¬ B âˆ§ Q`
[4]
For simple example programs that consist of a while loop preceded by some initialisation command (sequences) INIT and followed by some finalisation command (sequence) FINAL, a correctness proof with respect to precondition Pre and postcondition Post can be presented as follows:

[5]
Theorem â€œWhile-exampleâ€:
      Pre
    â‡’â…  INIT â®
        while B
          do
            C
          od â®
        FINAL
      â†
      Post
Proof:
    Pre    â•â•â•  Precondition
  â‡’â… INIT â†  âŸ¨ ? âŸ©
    Q      â•â•â•  Invariant
  â‡’â… while B do
        C
      od â†   âŸ¨ â€œWhileâ€ with subproof:
          B âˆ§ Q     â•â•â•  Loop condition and invariant
        â‡’â… C â†  âŸ¨ ? âŸ©
          Q         â•â•â•  Invariant
    âŸ©
    Â¬ B âˆ§ Q   â•â•â• Negated loop condition, and invariant
  â‡’â… FINAL â†  âŸ¨ ? âŸ©
    Post      â•â•â•  Postcondition
[6]
For the variables of the â€œWhileâ€ rule, note that B and C are parts of the program that is subject to the proof.

The invariant Q however needs to be provided

ideally as part of the program development process;
in any case at the time of proof.
That means: If the program developer did not document the intended invariant, you have to invent an appropriate invariant yourself.

The invariant will need to hold

immediately before the loop starts,
after each execution of the loop body,
and therefore also after the loop ends.
In general, invariant generation cannot be automated.

In praxis, an appropriate invariant often can be obtained by generalising the loop postcondition, keeping in mind that the invariant will typically mention all variables that are changed by the loop, and will explain how they are related.

[7]
As an example for how to use this â€œWhileâ€ rule, the code cell contains a proof skeleton for a simple loop correctness property.

As usual, simple â€œ?â€ steps may need to be replaced with arbitrarily many calculation steps; where the calculation operator given for the â€œ?â€ is an implication, having some or all of the replacing calculation steps being equivalence steps is no problem.

For integrating the Substitution invocation into the assignment step, â€œAssignmentâ€ now refers also to the following inference rule:

    Derived inference rule â€œAssignmentâ€:
        /\ x â€¢     `Î¦ â‰¡ Î¨[x â‰” E]`
                âŠ¦â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
                  `Î¦ â‡’â… x := E â† Î¨`
This has to be combined with the keyword hint item Substitution by with, not by comma. For example:

        0 â‰¤ i + 1
      â‡’â… i := i + 1 â† âŸ¨ â€œAssignmentâ€ with substitution âŸ©
        0 â‰¤ i
(As in H3 and Ex3.4, you continue to work bottom-up for these calculations!)

Fill the â€œSquaringâ€ proof below, and try to do this without copying, but as if you had started this yourself from scratch, working upwards as appropriate.

[8]
Theorem â€œSquaringâ€:
      true
    â‡’â…  i := 0 â®
        s := 0 â®
        d := 1 â®
        while i â‰  n
          do
            s := s + d â®
            d := d + 2 â®
            i := i + 1
          od
       â† s = n Â· n
Proof:
    true   â•â•â•  Precondition
  â‰¡âŸ¨ â€œIdempotency of âˆ§â€âŸ©
    true âˆ§ true 
  â‰¡âŸ¨ Fact `1 = 0 + 0 + 1`, Fact `0 = 0 Â· 0` âŸ©
    1 = 0 + 0 + 1 âˆ§ 0 = 0 Â· 0
  â‡’â… i := 0 â†âŸ¨ â€œAssignmentâ€ with substitution âŸ©
    1 = i + i + 1 âˆ§ 0 = i Â· i
  â‡’â… s := 0 â†âŸ¨ â€œAssignmentâ€ with substitution âŸ©
    1 = i + i + 1 âˆ§ s = i Â· i
  â‡’â… d := 1 â†âŸ¨ â€œAssignmentâ€ with substitution âŸ©
    d = i + i + 1 âˆ§ s = i Â· i      â•â•â•  Invariant
  â‡’â… while i â‰  n do
        s := s + d â®
        d := d + 2 â®
        i := i + 1
      od â†âŸ¨ â€œWhileâ€ with subproof:
          i â‰  n âˆ§ d = i + i + 1 âˆ§ s = i Â· i  â•â•â•  Loop condition and invariant
        â‡’âŸ¨ â€œWeakeningâ€ âŸ©
          d = i + i + 1 âˆ§ s = i Â· i
        â‰¡âŸ¨ â€œCancellation of +â€âŸ©
          d = i + i + 1 âˆ§ s + d = i Â· i + d 
        â‰¡âŸ¨ Substitution âŸ©
          d = i + i + 1 âˆ§ (s + d = i Â· i + z) [z â‰” d]
        â‰¡âŸ¨ â€œReplacementâ€âŸ© 
          d = i + i + 1 âˆ§ (s + d = i Â· i + z)[z â‰” i + i + 1]
        â‡’â… s := s + d â†âŸ¨ â€œAssignmentâ€ with substitution âŸ©
          d = i + i + 1 âˆ§ s = i Â· i + i + i + 1
        â‰¡âŸ¨ â€œCancellation of +â€ âŸ©
          d + 2 = i + i + 1 + 2 âˆ§ s = i Â· i + i + i + 1
        â‡’â… d := d + 2 â†âŸ¨ â€œAssignmentâ€ with substitution âŸ©
          d = i + i + 1 + 2 âˆ§ s = i Â· i + i + i + 1
        â‰¡âŸ¨ â€œIdentity of Â·â€, â€œDistributivity of Â· over +â€ âŸ©
          d = i + i + 1 + 2 âˆ§ s = i Â· i + 1 Â· i + 1 Â· (i + 1)
        â‰¡âŸ¨ â€œDistributivity of Â· over +â€âŸ© 
          d = i + i + 1 + 2 âˆ§ s = (i + 1) Â· (i + 1)
        â‡’â… i := i + 1 â†âŸ¨ â€œAssignmentâ€ with substitution
                         and Fact `1 + 1 = 2` âŸ©
          d = i + i + 1 âˆ§ s = i Â· i   â•â•â•  Invariant
    âŸ©
    Â¬ (i â‰  n) âˆ§ d = i + i + 1 âˆ§ s = i Â· i  â•â•â• Negated loop condition, and invariant
  â‡’âŸ¨ â€œWeakeningâ€âŸ©
    Â¬ (i â‰  n) âˆ§ s = i Â· i
  â‰¡âŸ¨ â€œDefinition of â‰ â€, â€œDouble negationâ€ âŸ©
    (i = n) âˆ§ s = i Â· i
  â‰¡âŸ¨ Substitution âŸ©
    (i = n) âˆ§ (s = z Â· z) [z â‰” i]
  â‰¡âŸ¨ â€œReplacementâ€, Substitution âŸ©
    (i = n) âˆ§ s = n Â· n
  â‡’âŸ¨ â€œWeakeningâ€âŸ©   
    s = n Â· n    â•â•â•  Postcondition

Theorem â€œSquaringâ€: true â‡’â… (i := 0 â® (s := 0 â® (d := 1 â® while (i â‰  n) do (s := s + d â® (d := d + 2 â® i := i + 1)) od))) â† s = n Â· n
Proof:
    Calculation for expected goal  `true â‡’â… (i := 0 â® (s := 0 â® (d := 1 â® while (i â‰  n) do (s := s + d â® (d := d + 2 â® i := i + 1)) od))) â† s = n Â· n`:
            true
        â‰¡ âŸ¨ â€œIdempotency of âˆ§â€ âŸ©
                â€” CalcCheck: Found (3.38) â€œIdempotency of âˆ§â€
                â€” CalcCheck: â”€ OK
            true âˆ§ true
        â‰¡ âŸ¨ Fact `1 = (0 + 0) + 1`, Fact `0 = 0 Â· 0` âŸ©
                â€” CalcCheck: â”€ OK
            1 = (0 + 0) + 1 âˆ§ 0 = 0 Â· 0
        â‡’â… i := 0 â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                â€” CalcCheck: â”€ OK
            1 = (i + i) + 1 âˆ§ 0 = i Â· i
        â‡’â… s := 0 â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                â€” CalcCheck: â”€ OK
            1 = (i + i) + 1 âˆ§ s = i Â· i
        â‡’â… d := 1 â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                â€” CalcCheck: â”€ OK
            d = (i + i) + 1 âˆ§ s = i Â· i
        â‡’â… while (i â‰  n) do (s := s + d â® (d := d + 2 â® i := i + 1)) od â† âŸ¨ â€œWhileâ€ with Subproof establishing `i â‰  n âˆ§ (d = (i + i) + 1 âˆ§ s = i Â· i) â‡’â… ((s := s + d â® d := d + 2) â® i := i + 1) â† d = (i + i) + 1 âˆ§ s = i Â· i`:
                    i â‰  n âˆ§ (d = (i + i) + 1 âˆ§ s = i Â· i)
                â‡’ âŸ¨ â€œWeakeningâ€ âŸ©
                        â€” CalcCheck: Found (3.76e) â€œWeakeningâ€, (3.76d) â€œWeakeningâ€, (3.76a) â€œWeakeningâ€, (3.76b) â€œWeakeningâ€, (3.76c) â€œWeakeningâ€, â€œWeakeningâ€
                        â€” CalcCheck: â”€ OK
                    d = (i + i) + 1 âˆ§ s = i Â· i
                â‰¡ âŸ¨ â€œCancellation of +â€ âŸ©
                        â€” CalcCheck: Found (15.8) â€œCancellation of +â€
                        â€” CalcCheck: â”€ OK
                    d = (i + i) + 1 âˆ§ s + d = i Â· i + d
                â‰¡ âŸ¨ Substitution âŸ©
                        â€” CalcCheck: â”€ OK
                    d = (i + i) + 1 âˆ§ (s + d = i Â· i + z)[z â‰” d]
                â‰¡ âŸ¨ â€œReplacementâ€ âŸ©
                        â€” CalcCheck: Found (3.84b) â€œReplacementâ€, (3.84a) â€œReplacementâ€, (3.84c) â€œReplacementâ€, (3.51) â€œReplacementâ€
                        â€” CalcCheck: â”€ OK
                    d = (i + i) + 1 âˆ§ (s + d = i Â· i + z)[z â‰” (i + i) + 1]
                â‡’â… s := s + d â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                        â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                        â€” CalcCheck: â”€ OK
                    d = (i + i) + 1 âˆ§ s = ((i Â· i + i) + i) + 1
                â‰¡ âŸ¨ â€œCancellation of +â€ âŸ©
                        â€” CalcCheck: Found (15.8) â€œCancellation of +â€
                        â€” CalcCheck: â”€ OK
                    d + 2 = ((i + i) + 1) + 2 âˆ§ s = ((i Â· i + i) + i) + 1
                â‡’â… d := d + 2 â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                        â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                        â€” CalcCheck: â”€ OK
                    d = ((i + i) + 1) + 2 âˆ§ s = ((i Â· i + i) + i) + 1
                â‰¡ âŸ¨ â€œIdentity of Â·â€, â€œDistributivity of Â· over +â€ âŸ©
                        â€” CalcCheck: Found (15.4) â€œMultiplicative identityâ€
                        â€” CalcCheck: Found (15.5) â€œDistributivity of Â· over +â€
                        â€” CalcCheck: â”€ OK
                    d = ((i + i) + 1) + 2 âˆ§ s = (i Â· i + 1 Â· i) + 1 Â· (i + 1)
                â‰¡ âŸ¨ â€œDistributivity of Â· over +â€ âŸ©
                        â€” CalcCheck: Found (15.5) â€œDistributivity of Â· over +â€
                        â€” CalcCheck: â”€ OK
                    d = ((i + i) + 1) + 2 âˆ§ s = (i + 1) Â· (i + 1)
                â‡’â… i := i + 1 â† âŸ¨ â€œAssignmentâ€ with Substitution and Fact `1 + 1 = 2` âŸ©
                        â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                        â€” CalcCheck: â”€ OK
                    d = (i + i) + 1 âˆ§ s = i Â· i            
            â€” CalcCheck: All steps OK
            âŸ©
                â€” CalcCheck: Found â€œWhileâ€
                â€” CalcCheck: â”€ OK
            Â¬ (i â‰  n) âˆ§ (d = (i + i) + 1 âˆ§ s = i Â· i)
        â‡’ âŸ¨ â€œWeakeningâ€ âŸ©
                â€” CalcCheck: Found (3.76e) â€œWeakeningâ€, (3.76d) â€œWeakeningâ€, (3.76a) â€œWeakeningâ€, (3.76b) â€œWeakeningâ€, (3.76c) â€œWeakeningâ€, â€œWeakeningâ€
                â€” CalcCheck: â”€ OK
            Â¬ (i â‰  n) âˆ§ s = i Â· i
        â‰¡ âŸ¨ â€œDefinition of â‰ â€, â€œDouble negationâ€ âŸ©
                â€” CalcCheck: Found â€œDefinition of â‰ â€, â€œDefinition of â‰ â€
                â€” CalcCheck: Found (3.12) â€œDouble negationâ€
                â€” CalcCheck: â”€ OK
            i = n âˆ§ s = i Â· i
        â‰¡ âŸ¨ Substitution âŸ©
                â€” CalcCheck: â”€ OK
            i = n âˆ§ (s = z Â· z)[z â‰” i]
        â‰¡ âŸ¨ â€œReplacementâ€, Substitution âŸ©
                â€” CalcCheck: Found (3.84b) â€œReplacementâ€, (3.84a) â€œReplacementâ€, (3.84c) â€œReplacementâ€, (3.51) â€œReplacementâ€
                â€” CalcCheck: â”€ OK
            i = n âˆ§ s = n Â· n
        â‡’ âŸ¨ â€œWeakeningâ€ âŸ©
                â€” CalcCheck: Found (3.76e) â€œWeakeningâ€, (3.76d) â€œWeakeningâ€, (3.76a) â€œWeakeningâ€, (3.76b) â€œWeakeningâ€, (3.76c) â€œWeakeningâ€, â€œWeakeningâ€
                â€” CalcCheck: â”€ OK
            s = n Â· n    
    â€” CalcCheck: All steps OK   
    â€” CalcCheck: Calculation matches goal â”€ OK
[9]
It has been mentioned that â€œquantification is somewhat like loopsâ€.

To give this a more precise meaning, the following shows how a loop can be used to calculate a sum quantification with a simple range.

To prove the correctness of this theorem, you will in particular need sum quantification material from Ex5.5.

The proof of the following theorem will otherwise follow the same approach as the proof above.

The program here applies the function f : â„¤ â†’ â„¤ to the different values of the loop variable i, and adds up the results.

You are allowed to use

    s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j
as invariant â€” with that, you will be able to finish the proof except that you will be unable to discharge the antecedent of a â€œSplit off âˆ‘-term â€¦â€ theorem. You are allowed to leave the resulting

   â€œSplit off âˆ‘-term ...â€ with ?
unresolved. (And read on below.)

[10]
Theorem â€œSumming upâ€:
      true
    â‡’â…  s := 0 â®
        i := 0 â®
        while i â‰  n
          do
            s := s + f i â®
            i := i + 1
          od
      â†
      s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < n â€¢ f j
Proof: 
    true   â•â•â•  Precondition
  â‰¡âŸ¨ â€œReflexivity of =â€âŸ©
    0 = 0
  â‰¡âŸ¨ â€œEmpty range for âˆ‘â€âŸ©
    0 = âˆ‘ j : â„¤ â™ false â€¢ f j
  â‰¡âŸ¨ 
    Subproof for `false â‰¡ 0 â‰¤ j âˆ§ j < 0`:
      Using â€œMutual implicationâ€:
        Subproof: 
            false â‡’ 0 â‰¤ j âˆ§ j < 0
          â‰¡âŸ¨ â€œex falso quodlibetâ€ âŸ© 
            true
        Subproof:
            0 â‰¤ j âˆ§ j < 0
          â‡’âŸ¨ â€œTransitivity of â‰¤ with <â€âŸ© 
            0 < 0
          â‰¡âŸ¨ â€œIrreflexivity of <â€âŸ© 
            false
    âŸ© 
    0 = âˆ‘ j : â„¤ â™ (0 â‰¤ j âˆ§ j < 0) â€¢ f j 
  â‰¡âŸ¨ â€œReflexivity of =â€âŸ© 
    0 = âˆ‘ j : â„¤ â™ 0 â‰¤ j < 0 â€¢ f j
  â‡’â… s := 0 â† âŸ¨ â€œAssignmentâ€ with substitution âŸ©
    s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < 0 â€¢ f j
  â‡’â… i := 0 â† âŸ¨ â€œAssignmentâ€ with substitution âŸ©
    s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j â•â•â•  Invariant
  â‡’â… while i â‰  n do
       s := s + f i â®
       i := i + 1
     od â†  âŸ¨ â€œWhileâ€ with subproof:
        (i â‰  0) âˆ§ s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j  â•â•â•  Loop condition and invariant
      â‡’âŸ¨ â€œWeakeningâ€ âŸ©
        s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j
      â‰¡âŸ¨ â€œCancellation of +â€ âŸ©
        s + f i = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j) + f i
      â‰¡âŸ¨ â€œSplit off âˆ‘-term from top of â‰¤-<-suc rangeâ€
          with ? âŸ© â•â•â• Leave this open!
        s + f i = âˆ‘ j : â„¤ â™ 0 â‰¤ j < (i + 1) â€¢ f j
      â‡’â… s := s + f i â† âŸ¨ â€œAssignmentâ€ with substitution âŸ©
        s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < (i + 1) â€¢ f j
      â‡’â… i := i + 1 â† âŸ¨ â€œAssignmentâ€ with substitution âŸ©
        s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j   â•â•â•  Invariant
    âŸ©
    Â¬ (i â‰  n) âˆ§ s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j  â•â•â• Negated loop condition, and invariant
  â‰¡âŸ¨ â€œDefinition of â‰ â€, â€œDouble negationâ€ âŸ©
    (i = n) âˆ§ s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j
  â‰¡âŸ¨ Substitution âŸ©
    (i = n) âˆ§ (s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < z â€¢ f j) [z â‰” i]
  â‰¡âŸ¨ â€œReplacementâ€, SubstitutionâŸ©
    (i = n) âˆ§ (s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < n â€¢ f j)
  â‡’âŸ¨ â€œWeakeningâ€âŸ© 
    s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < n â€¢ f j    â•â•â•  Postcondition

Theorem â€œSumming upâ€: true â‡’â… (s := 0 â® (i := 0 â® while (i â‰  n) do (s := s + f i â® i := i + 1) od)) â† s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < n â€¢ f j )
Proof:
    Calculation for expected goal  `true â‡’â… (s := 0 â® (i := 0 â® while (i â‰  n) do (s := s + f i â® i := i + 1) od)) â† s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < n â€¢ f j )`:
            true
        â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                â€” CalcCheck: â”€ OK
            0 = 0
        â‰¡ âŸ¨ â€œEmpty range for âˆ‘â€ âŸ©
                â€” CalcCheck: Found â€œEmpty range for âˆ‘â€
                â€” CalcCheck: â”€ OK
            0 = (âˆ‘ j : â„¤ â™ false â€¢ f j )
        â‰¡ âŸ¨ Subproof for `false â‰¡ 0 â‰¤ j âˆ§ j < 0`:
            Using â€œMutual implicationâ€:               
                â€” CalcCheck: Found (3.80) â€œMutual implicationâ€
                Subproof establishing `false â‡’ 0 â‰¤ j âˆ§ j < 0`:
                            false â‡’ 0 â‰¤ j âˆ§ j < 0
                        â‰¡ âŸ¨ â€œex falso quodlibetâ€ âŸ©
                                â€” CalcCheck: Found (3.75) â€œex falso quodlibetâ€
                                â€” CalcCheck: â”€ OK
                            true                    
                    â€” CalcCheck: All steps OK
                Subproof establishing `0 â‰¤ j âˆ§ j < 0 â‡’ false`:
                            0 â‰¤ j âˆ§ j < 0
                        â‡’ âŸ¨ â€œTransitivity of â‰¤ with <â€ âŸ©
                                â€” CalcCheck: Found (15.41b) â€œTransitivityâ€
                                â€” CalcCheck: â”€ OK
                            0 < 0
                        â‰¡ âŸ¨ â€œIrreflexivity of <â€ âŸ©
                                â€” CalcCheck: Found â€œIrreflexivity of <â€
                                â€” CalcCheck: â”€ OK
                            false                    
                    â€” CalcCheck: All steps OK
            âŸ©
                â€” CalcCheck: â”€ OK
            0 = (âˆ‘ j : â„¤ â™ 0 â‰¤ j âˆ§ j < 0 â€¢ f j )
        â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                â€” CalcCheck: OK (no change)
                â€” CalcCheck: â”€ OK
            0 = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < 0 â€¢ f j )
        â‡’â… s := 0 â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                â€” CalcCheck: â”€ OK
            s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < 0 â€¢ f j )
        â‡’â… i := 0 â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                â€” CalcCheck: â”€ OK
            s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j )
        â‡’â… while (i â‰  n) do (s := s + f i â® i := i + 1) od â† âŸ¨ â€œWhileâ€ with Subproof establishing `i â‰  0 âˆ§ s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j ) â‡’â… (s := s + f i â® i := i + 1) â† s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j )`:
                    i â‰  0 âˆ§ s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j )
                â‡’ âŸ¨ â€œWeakeningâ€ âŸ©
                        â€” CalcCheck: Found (3.76e) â€œWeakeningâ€, (3.76d) â€œWeakeningâ€, (3.76a) â€œWeakeningâ€, (3.76b) â€œWeakeningâ€, (3.76c) â€œWeakeningâ€, â€œWeakeningâ€
                        â€” CalcCheck: â”€ OK
                    s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j )
                â‰¡ âŸ¨ â€œCancellation of +â€ âŸ©
                        â€” CalcCheck: Found (15.8) â€œCancellation of +â€
                        â€” CalcCheck: â”€ OK
                    s + f i = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j ) + f i
                â‰¡ âŸ¨ â€œSplit off âˆ‘-term from top of â‰¤-<-suc rangeâ€ with ? âŸ©
                        â€” CalcCheck: Found â€œSplit off âˆ‘-term from top of â‰¤-<-suc rangeâ€
                        â€” CalcCheck: â€œ?â€ does not prove anything!
                        â€” CalcCheck: Could not justify this step!
                    s + f i = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i + 1 â€¢ f j )
                â‡’â… s := s + f i â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                        â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                        â€” CalcCheck: â”€ OK
                    s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i + 1 â€¢ f j )
                â‡’â… i := i + 1 â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                        â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                        â€” CalcCheck: â”€ OK
                    s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j )            
            â€” CalcCheck: 1 out of 5 steps not justified
            âŸ©
                â€” CalcCheck: Found â€œWhileâ€
                â€” CalcCheck: Could not justify this step!
            Â¬ (i â‰  n) âˆ§ s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j )
        â‰¡ âŸ¨ â€œDefinition of â‰ â€, â€œDouble negationâ€ âŸ©
                â€” CalcCheck: Found â€œDefinition of â‰ â€, â€œDefinition of â‰ â€
                â€” CalcCheck: Found (3.12) â€œDouble negationâ€
                â€” CalcCheck: â”€ OK
            i = n âˆ§ s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j )
        â‰¡ âŸ¨ Substitution âŸ©
                â€” CalcCheck: â”€ OK
            i = n âˆ§ (s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < z â€¢ f j ))[z â‰” i]
        â‰¡ âŸ¨ â€œReplacementâ€, Substitution âŸ©
                â€” CalcCheck: Found (3.84b) â€œReplacementâ€, (3.84a) â€œReplacementâ€, (3.84c) â€œReplacementâ€, (3.51) â€œReplacementâ€
                â€” CalcCheck: â”€ OK
            i = n âˆ§ s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < n â€¢ f j )
        â‡’ âŸ¨ â€œWeakeningâ€ âŸ©
                â€” CalcCheck: Found (3.76e) â€œWeakeningâ€, (3.76d) â€œWeakeningâ€, (3.76a) â€œWeakeningâ€, (3.76b) â€œWeakeningâ€, (3.76c) â€œWeakeningâ€, â€œWeakeningâ€
                â€” CalcCheck: â”€ OK
            s = (âˆ‘ j : â„¤ â™ 0 â‰¤ j < n â€¢ f j )    
    â€” CalcCheck: 1 out of 11 steps not justified   
    â€” CalcCheck: Calculation matches goal â”€ OK
[11]
What you would need in place of that â€œ?â€ is a proof for 0 â‰¤ i â€” it is actually easy to show that the above while-loop preserves positivity of i, using 0 â‰¤ i as invariant to prove the following:

[12]
Theorem â€œKeeping `i` positive while summing upâ€:
      0 â‰¤ i
    â‡’â…  while i â‰  n
          do
            s := s + f i â®
            i := i + 1
          od
      â†
      0 â‰¤ i 
Proof:
    0 â‰¤ i   â•â•â•  Invariant
  â‡’â… while i â‰  n do
       s := s + f i â®
       i := i + 1
     od â†  âŸ¨ â€œWhileâ€ with subproof:
        i â‰  n âˆ§ 0 â‰¤ i
      â‡’âŸ¨ â€œWeakeningâ€ âŸ©
        0 â‰¤ i
      â‰¡âŸ¨ â€œIdentity of âˆ§â€âŸ©
        0 â‰¤ i âˆ§ (true)
      â‰¡âŸ¨ Fact `0 â‰¤ 1`âŸ©
        0 â‰¤ i âˆ§ 0 â‰¤ 1
      â‡’âŸ¨ â€œâ‰¤-Monotonicity of +â€, Fact `0 + 0 = 0`âŸ©    
        0 â‰¤ i + 1
      â‡’â… s := s + f i â† âŸ¨ â€œAssignmentâ€ with substitution âŸ© 
        0 â‰¤ i + 1
      â‡’â… i := i + 1 â† âŸ¨ â€œAssignmentâ€ with substitution âŸ© 
        0 â‰¤ i  
    âŸ©
    Â¬ (i â‰  n) âˆ§ 0 â‰¤ i  â•â•â• Negated loop condition, and invariant
  â‡’âŸ¨ â€œWeakeningâ€ âŸ©
    0 â‰¤ i   â•â•â•  Postcondition

Theorem â€œKeeping `i` positive while summing upâ€: 0 â‰¤ i â‡’â… while (i â‰  n) do (s := s + f i â® i := i + 1) od â† 0 â‰¤ i
Proof:
    Calculation for expected goal  `0 â‰¤ i â‡’â… while (i â‰  n) do (s := s + f i â® i := i + 1) od â† 0 â‰¤ i`:
            0 â‰¤ i
        â‡’â… while (i â‰  n) do (s := s + f i â® i := i + 1) od â† âŸ¨ â€œWhileâ€ with Subproof establishing `i â‰  n âˆ§ 0 â‰¤ i â‡’â… (s := s + f i â® i := i + 1) â† 0 â‰¤ i`:
                    i â‰  n âˆ§ 0 â‰¤ i
                â‡’ âŸ¨ â€œWeakeningâ€ âŸ©
                        â€” CalcCheck: Found (3.76e) â€œWeakeningâ€, (3.76d) â€œWeakeningâ€, (3.76a) â€œWeakeningâ€, (3.76b) â€œWeakeningâ€, (3.76c) â€œWeakeningâ€, â€œWeakeningâ€
                        â€” CalcCheck: â”€ OK
                    0 â‰¤ i
                â‰¡ âŸ¨ â€œIdentity of âˆ§â€ âŸ©
                        â€” CalcCheck: Found (3.39) â€œIdentity of âˆ§â€
                        â€” CalcCheck: â”€ OK
                    0 â‰¤ i âˆ§ true
                â‰¡ âŸ¨ Fact `0 â‰¤ 1` âŸ©
                        â€” CalcCheck: â”€ OK
                    0 â‰¤ i âˆ§ 0 â‰¤ 1
                â‡’ âŸ¨ â€œâ‰¤-Monotonicity of +â€, Fact `0 + 0 = 0` âŸ©
                        â€” CalcCheck: Found â€œTwo-sided â‰¤-Monotonicity of +â€, â€œâ‰¤-Monotonicity of +â€
                        â€” CalcCheck: â”€ OK
                    0 â‰¤ i + 1
                â‡’â… s := s + f i â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                        â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                        â€” CalcCheck: â”€ OK
                    0 â‰¤ i + 1
                â‡’â… i := i + 1 â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                        â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                        â€” CalcCheck: â”€ OK
                    0 â‰¤ i            
            â€” CalcCheck: All steps OK
            âŸ©
                â€” CalcCheck: Found â€œWhileâ€
                â€” CalcCheck: â”€ OK
            Â¬ (i â‰  n) âˆ§ 0 â‰¤ i
        â‡’ âŸ¨ â€œWeakeningâ€ âŸ©
                â€” CalcCheck: Found (3.76e) â€œWeakeningâ€, (3.76d) â€œWeakeningâ€, (3.76a) â€œWeakeningâ€, (3.76b) â€œWeakeningâ€, (3.76c) â€œWeakeningâ€, â€œWeakeningâ€
                â€” CalcCheck: â”€ OK
            0 â‰¤ i    
    â€” CalcCheck: All steps OK   
    â€” CalcCheck: Calculation matches goal â”€ OK
[13]
This invites re-doing the proof of â€œSumming upâ€ with the following invariant:

    0 â‰¤ i  âˆ§  s = âˆ‘ j : â„¤ â™ 0 â‰¤ j < i â€¢ f j
This is not expected as part of the current homework! (But allowed.)