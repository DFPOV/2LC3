â€” Assignment 2 Notebook 1: Correctness of `rev`

[1]
Propositional logic, predicate logic, and the sequence material of exercises 6.1 and 6.2 are preloaded here.

Four hint items per hint are allowed here; Evaluation is disabled, but Facts are allowed.

[2]
The task here is similar to the task in Ex7.3, namely proving correctness of an imperative sequence manipulation program.

[3]
We define reversing of sequences:

[4]
Declaration: reverse : Seq A â†’ Seq A
Axiom â€œDefinition of `reverse` for ğœ–â€:  reverse ğœ– = ğœ–
Axiom â€œDefinition of `reverse` for â—ƒâ€:  reverse (x â—ƒ xs) = reverse xs â–¹ x

Declaration: reverse : Seq A â†’ Seq A
Axiom â€œDefinition of `reverse` for ğœ–â€: reverse ğœ– = ğœ–
Axiom â€œDefinition of `reverse` for â—ƒâ€: reverse (x â—ƒ xs) = reverse xs â–¹ x
[5]
For natural proofs of some of the theorems here you will probably need an additional properties â€” you can prove these separately as additional Lemmas or Theorems, or as closed (by universal quantification) local properties in Side proofs.

First prove that reversing a concatenation produces the same result as concatenating, in reverse order, the reversed arguments:

[6]
Lemma â€œMutual associativity of â–¹ with âŒ¢â€:
    ys âŒ¢ (xs â–¹ x) = (ys âŒ¢ xs) â–¹ x
Proof:
  By induction on `ys : Seq A`:
    Base case:
        ğœ– âŒ¢ (xs â–¹ x) = (ğœ– âŒ¢ xs) â–¹ x
      â‰¡âŸ¨ â€œLeft-identity of âŒ¢â€ âŸ©
        (xs â–¹ x) = xs â–¹ x
      â‰¡âŸ¨ â€œReflexivity of =â€ âŸ©
        true
    Induction step:
      For any `y : A`:
          (y â—ƒ ys) âŒ¢ (xs â–¹ x) = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
        â‰¡âŸ¨ â€œMutual associativity of â—ƒ with âŒ¢â€ âŸ©
          (y â—ƒ (ys âŒ¢ (xs â–¹ x))) = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
        â‰¡âŸ¨ Induction hypothesis âŸ©
          (y â—ƒ ((ys âŒ¢ xs) â–¹ x)) = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
        â‰¡âŸ¨ â€œDefinition of â–¹ for â—ƒâ€ âŸ©
          ((y â—ƒ (ys âŒ¢ xs)) â–¹ x) = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
        â‰¡âŸ¨ â€œMutual associativity of â—ƒ with âŒ¢â€ âŸ©
          (((y â—ƒ ys) âŒ¢ xs) â–¹ x) = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
        â‰¡âŸ¨ â€œReflexivity of =â€ âŸ©
          true

Lemma â€œMutual associativity of â–¹ with âŒ¢â€: ys âŒ¢ (xs â–¹ x) = (ys âŒ¢ xs) â–¹ x
Proof:
    By induction on `ys : Seq A`:
        Base case:
            Calculation for expected goal  `ğœ– âŒ¢ (xs â–¹ x) = (ğœ– âŒ¢ xs) â–¹ x`:
                    ğœ– âŒ¢ (xs â–¹ x) = (ğœ– âŒ¢ xs) â–¹ x
                â‰¡ âŸ¨ â€œLeft-identity of âŒ¢â€ âŸ©
                        â€” CalcCheck: Found (13.17) â€œLeft-identity of âŒ¢â€
                        â€” CalcCheck: â”€ OK
                    xs â–¹ x = xs â–¹ x
                â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                        â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                        â€” CalcCheck: â”€ OK
                    true            
            â€” CalcCheck: All steps OK           
            â€” CalcCheck: Calculation matches goal â”€ OK
        Induction step:
            For any ` y : A`:
                Calculation for expected goal  `(y â—ƒ ys) âŒ¢ (xs â–¹ x) = ((y â—ƒ ys) âŒ¢ xs) â–¹ x`:
                        (y â—ƒ ys) âŒ¢ (xs â–¹ x) = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
                    â‰¡ âŸ¨ â€œMutual associativity of â—ƒ with âŒ¢â€ âŸ©
                            â€” CalcCheck: Found (13.18) â€œMutual associativity of â—ƒ with âŒ¢â€
                            â€” CalcCheck: â”€ OK
                        y â—ƒ (ys âŒ¢ (xs â–¹ x)) = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
                    â‰¡ âŸ¨ Induction hypothesis âŸ©
                            â€” CalcCheck: Found induction hypothesis `ys âŒ¢ (xs â–¹ x) = (ys âŒ¢ xs) â–¹ x`
                            â€” CalcCheck: â”€ OK
                        y â—ƒ ((ys âŒ¢ xs) â–¹ x) = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
                    â‰¡ âŸ¨ â€œDefinition of â–¹ for â—ƒâ€ âŸ©
                            â€” CalcCheck: Found (13.13) â€œDefinition of â–¹ for â—ƒâ€
                            â€” CalcCheck: â”€ OK
                        (y â—ƒ (ys âŒ¢ xs)) â–¹ x = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
                    â‰¡ âŸ¨ â€œMutual associativity of â—ƒ with âŒ¢â€ âŸ©
                            â€” CalcCheck: Found (13.18) â€œMutual associativity of â—ƒ with âŒ¢â€
                            â€” CalcCheck: â”€ OK
                        ((y â—ƒ ys) âŒ¢ xs) â–¹ x = ((y â—ƒ ys) âŒ¢ xs) â–¹ x
                    â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                            â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                            â€” CalcCheck: â”€ OK
                        true                
                â€” CalcCheck: All steps OK               
                â€” CalcCheck: Calculation matches goal â”€ OK    
    â€” CalcCheck: Base case and induction step both present   
    â€” CalcCheck: Induction proof OK
[7]
Theorem â€œReverse of âŒ¢â€:
   reverse (xs âŒ¢ ys) = reverse ys âŒ¢ reverse xs
Proof:
  By induction on `xs : Seq A`:
    Base case:
        reverse (ğœ– âŒ¢ ys) = reverse ys âŒ¢ reverse ğœ–
      â‰¡âŸ¨ â€œDefinition of `reverse` for ğœ–â€âŸ©
        reverse (ğœ– âŒ¢ ys) = reverse ys âŒ¢ ğœ–
      â‰¡âŸ¨ â€œRight-identity of âŒ¢â€, â€œLeft-identity of âŒ¢â€ âŸ©
        reverse (ys) = reverse (ys)
      â‰¡âŸ¨ â€œReflexivity of =â€âŸ©
        true 
    Induction step:
      For any `x`:
          reverse ((x â—ƒ xs) âŒ¢ ys) = reverse ys âŒ¢ reverse (x â—ƒ xs)  
        â‰¡âŸ¨ â€œDefinition of âŒ¢ for â—ƒâ€, â€œDefinition of `reverse` for â—ƒâ€âŸ©
          reverse (xs âŒ¢ ys) â–¹ x = reverse ys âŒ¢ reverse xs â–¹ x
        â‰¡âŸ¨ Induction hypothesis âŸ©
          (reverse ys âŒ¢ reverse xs) â–¹ x = reverse ys âŒ¢ (reverse xs â–¹ x)
        â‰¡âŸ¨ â€œMutual associativity of â–¹ with âŒ¢â€âŸ© 
          reverse ys âŒ¢ (reverse xs â–¹ x) = reverse ys âŒ¢ (reverse xs) â–¹ x
        â‰¡âŸ¨ â€œReflexivity of =â€âŸ©
          true 

Theorem â€œReverse of âŒ¢â€: reverse (xs âŒ¢ ys) = reverse ys âŒ¢ reverse xs
Proof:
    By induction on `xs : Seq A`:
        Base case:
            Calculation for expected goal  `reverse (ğœ– âŒ¢ ys) = reverse ys âŒ¢ reverse ğœ–`:
                    reverse (ğœ– âŒ¢ ys) = reverse ys âŒ¢ reverse ğœ–
                â‰¡ âŸ¨ â€œDefinition of `reverse` for ğœ–â€ âŸ©
                        â€” CalcCheck: Found â€œDefinition of `reverse` for ğœ–â€
                        â€” CalcCheck: â”€ OK
                    reverse (ğœ– âŒ¢ ys) = reverse ys âŒ¢ ğœ–
                â‰¡ âŸ¨ â€œRight-identity of âŒ¢â€, â€œLeft-identity of âŒ¢â€ âŸ©
                        â€” CalcCheck: Found (13.19) â€œRight-identity of âŒ¢â€
                        â€” CalcCheck: Found (13.17) â€œLeft-identity of âŒ¢â€
                        â€” CalcCheck: â”€ OK
                    reverse ys = reverse ys
                â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                        â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                        â€” CalcCheck: â”€ OK
                    true            
            â€” CalcCheck: All steps OK           
            â€” CalcCheck: Calculation matches goal â”€ OK
        Induction step:
            For any ` x`:
                Calculation for expected goal  `reverse ((x â—ƒ xs) âŒ¢ ys) = reverse ys âŒ¢ reverse (x â—ƒ xs)`:
                        reverse ((x â—ƒ xs) âŒ¢ ys) = reverse ys âŒ¢ reverse (x â—ƒ xs)
                    â‰¡ âŸ¨ â€œDefinition of âŒ¢ for â—ƒâ€, â€œDefinition of `reverse` for â—ƒâ€ âŸ©
                            â€” CalcCheck: Found (13.18) â€œMutual associativity of â—ƒ with âŒ¢â€
                            â€” CalcCheck: Found â€œDefinition of `reverse` for â—ƒâ€
                            â€” CalcCheck: â”€ OK
                        reverse (xs âŒ¢ ys) â–¹ x = reverse ys âŒ¢ (reverse xs â–¹ x)
                    â‰¡ âŸ¨ Induction hypothesis âŸ©
                            â€” CalcCheck: Found induction hypothesis `reverse (xs âŒ¢ ys) = reverse ys âŒ¢ reverse xs`
                            â€” CalcCheck: â”€ OK
                        (reverse ys âŒ¢ reverse xs) â–¹ x = reverse ys âŒ¢ (reverse xs â–¹ x)
                    â‰¡ âŸ¨ â€œMutual associativity of â–¹ with âŒ¢â€ âŸ©
                            â€” CalcCheck: Found â€œMutual associativity of â–¹ with âŒ¢â€
                            â€” CalcCheck: â”€ OK
                        reverse ys âŒ¢ (reverse xs â–¹ x) = reverse ys âŒ¢ (reverse xs â–¹ x)
                    â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                            â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                            â€” CalcCheck: â”€ OK
                        true                
                â€” CalcCheck: All steps OK               
                â€” CalcCheck: Calculation matches goal â”€ OK    
    â€” CalcCheck: Base case and induction step both present   
    â€” CalcCheck: Induction proof OK
[8]
As in Ex7.3, we introduce the head and tail functions that extract the constituents of non-empty sequences:

[9]
Declaration: head : Seq A â†’ A
Declaration: tail : Seq A â†’ Seq A

Declaration: head : Seq A â†’ A
Declaration: tail : Seq A â†’ Seq A
[10]
Note that the following axioms leave â€œhead ğœ–â€ and â€œtail ğœ–â€ unspecified â€” nothing interesting can be proven about these expressions. (Only boring things like â€œhead ğœ– = head ğœ–â€â€¦)

[11]
Axiom â€œDefinition of `head`â€: head (x â—ƒ xs) = x
Axiom â€œDefinition of `tail`â€: tail (x â—ƒ xs) = xs

Axiom â€œDefinition of `head`â€: head (x â—ƒ xs) = x
Axiom â€œDefinition of `tail`â€: tail (x â—ƒ xs) = xs
[12]
For â€œNon-empty-sequence decompositionâ€, an induction proof is one (easy) option, but not the only option â€” you could also use â€œCons decompositionâ€.

[13]
Theorem â€œNon-empty-sequence decompositionâ€:
    xs â‰  ğœ– â‡’ xs = head xs â—ƒ tail xs
Proof:
  By induction on `xs : Seq A`:   
    Base case:
      Assuming `ğœ– â‰  ğœ–`:
          head ğœ– â—ƒ tail ğœ– = ğœ–
        â‰¡âŸ¨ â€œCons is not emptyâ€ âŸ©
          false
        â‰¡âŸ¨ â€œDefinition of `false`â€ âŸ©
          Â¬ true
        â‰¡âŸ¨ Assumption `ğœ– â‰  ğœ–`âŸ©
          Â¬ (ğœ– â‰  ğœ–)
        â‰¡âŸ¨ â€œNegation of â‰ â€âŸ©
          ğœ– = ğœ–
        â‰¡âŸ¨ â€œReflexivity of =â€âŸ©
          true
    Induction step:
      For any `x`:
        Assuming `x â—ƒ xs â‰  ğœ–`:
            x â—ƒ xs = head (x â—ƒ xs) â—ƒ tail (x â—ƒ xs)
          â‰¡âŸ¨ â€œDefinition of `head`â€, â€œDefinition of `tail`â€âŸ©
            x â—ƒ xs = x â—ƒ xs
          â‰¡âŸ¨ â€œReflexivity of =â€âŸ©
            true  
          

Theorem â€œNon-empty-sequence decompositionâ€: xs â‰  ğœ– â‡’ xs = head xs â—ƒ tail xs
Proof:
    By induction on `xs : Seq A`:
        Base case:
            Assuming `ğœ– â‰  ğœ–`:
            â€” CalcCheck: Assumption matches goal
                Calculation for expected goal  `ğœ– = head ğœ– â—ƒ tail ğœ–`:
                        head ğœ– â—ƒ tail ğœ– = ğœ–
                    â‰¡ âŸ¨ â€œCons is not emptyâ€ âŸ©
                            â€” CalcCheck: Found â€œCons is not emptyâ€, (13.3) â€œCons is not emptyâ€
                            â€” CalcCheck: â”€ OK
                        false
                    â‰¡ âŸ¨ â€œDefinition of `false`â€ âŸ©
                            â€” CalcCheck: Found (3.8) â€œDefinition of `false`â€
                            â€” CalcCheck: â”€ OK
                        Â¬ true
                    â‰¡ âŸ¨ Assumption `ğœ– â‰  ğœ–` âŸ©
                            â€” CalcCheck: Found assumption `ğœ– â‰  ğœ–`
                            â€” CalcCheck: â”€ OK
                        Â¬ (ğœ– â‰  ğœ–)
                    â‰¡ âŸ¨ â€œNegation of â‰ â€ âŸ©
                            â€” CalcCheck: Found â€œNegation of â‰ â€
                            â€” CalcCheck: â”€ OK
                        ğœ– = ğœ–
                    â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                            â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                            â€” CalcCheck: â”€ OK
                        true                
                â€” CalcCheck: All steps OK               
                â€” CalcCheck: Calculation matches goal â”€ OK
        Induction step:
            For any ` x`:
                Assuming `x â—ƒ xs â‰  ğœ–`:
                â€” CalcCheck: Assumption matches goal
                    Calculation for expected goal  `x â—ƒ xs = head (x â—ƒ xs) â—ƒ tail (x â—ƒ xs)`:
                            x â—ƒ xs = head (x â—ƒ xs) â—ƒ tail (x â—ƒ xs)
                        â‰¡ âŸ¨ â€œDefinition of `head`â€, â€œDefinition of `tail`â€ âŸ©
                                â€” CalcCheck: Found â€œDefinition of `head`â€
                                â€” CalcCheck: Found â€œDefinition of `tail`â€
                                â€” CalcCheck: â”€ OK
                            x â—ƒ xs = x â—ƒ xs
                        â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                                â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                                â€” CalcCheck: â”€ OK
                            true                    
                    â€” CalcCheck: All steps OK                   
                    â€” CalcCheck: Calculation matches goal â”€ OK    
    â€” CalcCheck: Base case and induction step both present   
    â€” CalcCheck: Induction proof OK
[14]
A linear-time imperative implementation of reverse of sequences that are implemented as singly-linked lists can be achieved via a loop with the following program:

    ys := ğœ– â®
    while xs â‰  ğœ– do
        ys := head xs â—ƒ ys â®
        xs := tail xs
    od
To prove this correct with respect to precondition xs = xsâ‚€ and postcondition

    ys = reverse xsâ‚€
you need to choose an appropriate invariant for the while loop â€” comparing the situation here with the â€œAddingâ€ variants in Ex6.6 may be helpful.

You may need subproofs and/or additional lemmas or local properties.

[15]
Lemma â€œReverse Equalityâ€:
      xs = ys â‡’ reverse xs = reverse ys
Proof:
    xs = ys
  â‡’âŸ¨ â€œLeibnizâ€âŸ©
    (reverse z) [z â‰” xs] = (reverse z) [z â‰” ys]
  â‰¡âŸ¨ Substitution âŸ©
    reverse xs = reverse ys   

Lemma â€œReverse Equalityâ€: xs = ys â‡’ reverse xs = reverse ys
Proof:
    Calculation for expected goal  `xs = ys â‡’ reverse xs = reverse ys`:
            xs = ys
        â‡’ âŸ¨ â€œLeibnizâ€ âŸ©
                â€” CalcCheck: Found (3.83) â€œLeibnizâ€
                â€” CalcCheck: â”€ OK
            (reverse z)[z â‰” xs] = (reverse z)[z â‰” ys]
        â‰¡ âŸ¨ Substitution âŸ©
                â€” CalcCheck: â”€ OK
            reverse xs = reverse ys    
    â€” CalcCheck: All steps OK   
    â€” CalcCheck: Calculation matches goal â”€ OK
[16]
Lemma â€œNon-empty-sequence decompositionâ€:
        xs = head xs â—ƒ tail xs â‰¡ xs â‰  ğœ–
Proof:
  Using â€œMutual implicationâ€:
    Subproof for `xs = head xs â—ƒ tail xs â‡’ xs â‰  ğœ–`:
        Assuming `xs = head xs â—ƒ tail xs`:
            xs â‰  ğœ–
          â‰¡âŸ¨ Assumption `xs = head xs â—ƒ tail xs`âŸ© 
            head xs â—ƒ tail xs â‰  ğœ–
          â‰¡âŸ¨ â€œCons is not emptyâ€âŸ©
            true 
    Subproof for `xs â‰  ğœ– â‡’ xs = head xs â—ƒ tail xs`:
        By â€œNon-empty-sequence decompositionâ€

Lemma â€œNon-empty-sequence decompositionâ€: xs = head xs â—ƒ tail xs â‰¡ xs â‰  ğœ–
Proof:
    Using â€œMutual implicationâ€:       
        â€” CalcCheck: Found (3.80) â€œMutual implicationâ€
        Subproof for `xs = head xs â—ƒ tail xs â‡’ xs â‰  ğœ–`:
            Assuming `xs = head xs â—ƒ tail xs`:
            â€” CalcCheck: Assumption matches goal
                Calculation for expected goal  `xs â‰  ğœ–`:
                        xs â‰  ğœ–
                    â‰¡ âŸ¨ Assumption `xs = head xs â—ƒ tail xs` âŸ©
                            â€” CalcCheck: Found assumption `xs = head xs â—ƒ tail xs`
                            â€” CalcCheck: â”€ OK
                        head xs â—ƒ tail xs â‰  ğœ–
                    â‰¡ âŸ¨ â€œCons is not emptyâ€ âŸ©
                            â€” CalcCheck: Found â€œCons is not emptyâ€, (13.3) â€œCons is not emptyâ€
                            â€” CalcCheck: â”€ OK
                        true                
                â€” CalcCheck: All steps OK               
                â€” CalcCheck: Calculation matches goal â”€ OK
        Subproof for `xs â‰  ğœ– â‡’ xs = head xs â—ƒ tail xs`:
            By â€œNon-empty-sequence decompositionâ€               
                â€” CalcCheck: Found â€œNon-empty-sequence decompositionâ€
[17]
Lemma â€œMutual associativity of âŒ¢ with â–¹â€:
    xs â–¹ x âŒ¢ ys = xs âŒ¢ (x â—ƒ ys)
Proof:
    By induction on `xs : Seq A`:
      Base case:
          (ğœ– â–¹ x) âŒ¢ ys = ğœ– âŒ¢ (x â—ƒ ys)
        â‰¡âŸ¨ â€œDefinition of â–¹ for ğœ–â€, â€œDefinition of âŒ¢ for ğœ–â€âŸ©
          (x â—ƒ ğœ–) âŒ¢ ys = (x â—ƒ ys)
        â‰¡âŸ¨ â€œMutual associativity of â—ƒ with âŒ¢â€âŸ©
          x â—ƒ (ğœ– âŒ¢ ys) = (x â—ƒ ys) 
        â‰¡âŸ¨ â€œLeft-identity of âŒ¢â€âŸ©
          x â—ƒ ys = x â—ƒ ys
        â‰¡âŸ¨ â€œReflexivity of =â€âŸ©
          true
      Induction step:
        For any `z : A`:
            (z â—ƒ xs) â–¹ x âŒ¢ ys = (z â—ƒ xs) âŒ¢ (x â—ƒ ys)
          â‰¡âŸ¨ â€œMutual associativity of â—ƒ with âŒ¢â€âŸ©
            (z â—ƒ xs) â–¹ x âŒ¢ ys = z â—ƒ (xs âŒ¢ (x â—ƒ ys))
          â‰¡âŸ¨ Induction hypothesis âŸ©
            (z â—ƒ xs) â–¹ x âŒ¢ ys = z â—ƒ xs â–¹ x âŒ¢ ys
          â‰¡âŸ¨ â€œDefinition of â–¹ for â—ƒâ€, â€œMutual associativity of â—ƒ with âŒ¢â€âŸ©
            z â—ƒ ((xs â–¹ x) âŒ¢ ys) = z â—ƒ (xs â–¹ x âŒ¢ ys)
          â‰¡âŸ¨ â€œReflexivity of =â€ âŸ©
            true

Lemma â€œMutual associativity of âŒ¢ with â–¹â€: (xs â–¹ x) âŒ¢ ys = xs âŒ¢ (x â—ƒ ys)
Proof:
    By induction on `xs : Seq A`:
        Base case:
            Calculation for expected goal  `(ğœ– â–¹ x) âŒ¢ ys = ğœ– âŒ¢ (x â—ƒ ys)`:
                    (ğœ– â–¹ x) âŒ¢ ys = ğœ– âŒ¢ (x â—ƒ ys)
                â‰¡ âŸ¨ â€œDefinition of â–¹ for ğœ–â€, â€œDefinition of âŒ¢ for ğœ–â€ âŸ©
                        â€” CalcCheck: Found (13.12) â€œDefinition of â–¹ for ğœ–â€
                        â€” CalcCheck: Found (13.17) â€œLeft-identity of âŒ¢â€
                        â€” CalcCheck: â”€ OK
                    (x â—ƒ ğœ–) âŒ¢ ys = x â—ƒ ys
                â‰¡ âŸ¨ â€œMutual associativity of â—ƒ with âŒ¢â€ âŸ©
                        â€” CalcCheck: Found (13.18) â€œMutual associativity of â—ƒ with âŒ¢â€
                        â€” CalcCheck: â”€ OK
                    x â—ƒ (ğœ– âŒ¢ ys) = x â—ƒ ys
                â‰¡ âŸ¨ â€œLeft-identity of âŒ¢â€ âŸ©
                        â€” CalcCheck: Found (13.17) â€œLeft-identity of âŒ¢â€
                        â€” CalcCheck: â”€ OK
                    x â—ƒ ys = x â—ƒ ys
                â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                        â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                        â€” CalcCheck: â”€ OK
                    true            
            â€” CalcCheck: All steps OK           
            â€” CalcCheck: Calculation matches goal â”€ OK
        Induction step:
            For any ` z : A`:
                Calculation for expected goal  `((z â—ƒ xs) â–¹ x) âŒ¢ ys = (z â—ƒ xs) âŒ¢ (x â—ƒ ys)`:
                        ((z â—ƒ xs) â–¹ x) âŒ¢ ys = (z â—ƒ xs) âŒ¢ (x â—ƒ ys)
                    â‰¡ âŸ¨ â€œMutual associativity of â—ƒ with âŒ¢â€ âŸ©
                            â€” CalcCheck: Found (13.18) â€œMutual associativity of â—ƒ with âŒ¢â€
                            â€” CalcCheck: â”€ OK
                        ((z â—ƒ xs) â–¹ x) âŒ¢ ys = z â—ƒ (xs âŒ¢ (x â—ƒ ys))
                    â‰¡ âŸ¨ Induction hypothesis âŸ©
                            â€” CalcCheck: Found induction hypothesis `(xs â–¹ x) âŒ¢ ys = xs âŒ¢ (x â—ƒ ys)`
                            â€” CalcCheck: â”€ OK
                        ((z â—ƒ xs) â–¹ x) âŒ¢ ys = z â—ƒ ((xs â–¹ x) âŒ¢ ys)
                    â‰¡ âŸ¨ â€œDefinition of â–¹ for â—ƒâ€, â€œMutual associativity of â—ƒ with âŒ¢â€ âŸ©
                            â€” CalcCheck: Found (13.13) â€œDefinition of â–¹ for â—ƒâ€
                            â€” CalcCheck: Found (13.18) â€œMutual associativity of â—ƒ with âŒ¢â€
                            â€” CalcCheck: â”€ OK
                        z â—ƒ ((xs â–¹ x) âŒ¢ ys) = z â—ƒ ((xs â–¹ x) âŒ¢ ys)
                    â‰¡ âŸ¨ â€œReflexivity of =â€ âŸ©
                            â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                            â€” CalcCheck: â”€ OK
                        true                
                â€” CalcCheck: All steps OK               
                â€” CalcCheck: Calculation matches goal â”€ OK    
    â€” CalcCheck: Base case and induction step both present   
    â€” CalcCheck: Induction proof OK
[18]
Theorem â€œCorrectness of `rev`â€:
      xs = xsâ‚€
    â‡’â…  ys := ğœ– â®
        while xs â‰  ğœ–
          do
            ys := head xs â—ƒ ys â®
            xs := tail xs
          od
      â†
      ys = reverse xsâ‚€
Proof:
    xs = xsâ‚€                                                      â•â•â• Precondition
  â‡’âŸ¨ â€œReverse Equalityâ€âŸ© 
    reverse xs = reverse xsâ‚€
  â‰¡âŸ¨ â€œReflexivity of =â€, â€œRight-identity of âŒ¢â€âŸ©
    reverse xsâ‚€ = reverse xs âŒ¢ ğœ–
  â‡’â… ys := ğœ– â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ© 
    reverse xsâ‚€ = reverse xs âŒ¢ ys                                â•â•â• Invariant
  â‡’â… while xs â‰  ğœ– do
       ys := head xs â—ƒ ys â®
       xs := tail xs
     od â†  âŸ¨ â€œWhileâ€ with subproof:
        (xs â‰  ğœ–) âˆ§  reverse xsâ‚€ = reverse xs âŒ¢ ys             â•â•â• Invariant with loop condtion 
      â‰¡âŸ¨ â€œNon-empty-sequence decompositionâ€âŸ© 
        (xs = head xs â—ƒ tail xs) âˆ§ reverse xsâ‚€ = reverse xs âŒ¢ ys
      â‰¡âŸ¨ Substitution, â€œReplacementâ€âŸ©
        (xs = head xs â—ƒ tail xs) âˆ§ (reverse xsâ‚€ = reverse z âŒ¢ ys) [ z â‰” head xs â—ƒ tail xs]
      â‰¡âŸ¨ Substitution âŸ©
        (xs = head xs â—ƒ tail xs) âˆ§ (reverse xsâ‚€ = reverse (head xs â—ƒ tail xs) âŒ¢ ys)
      â‡’âŸ¨ â€œWeakeningâ€âŸ©
        reverse xsâ‚€ = reverse (head xs â—ƒ tail xs) âŒ¢ ys
      â‰¡âŸ¨ â€œDefinition of `reverse` for â—ƒâ€âŸ©
        reverse xsâ‚€ = reverse (tail xs) â–¹ (head xs) âŒ¢ ys
      â‰¡âŸ¨â€œMutual associativity of âŒ¢ with â–¹â€âŸ© 
        reverse xsâ‚€ = reverse (tail xs) âŒ¢ (head xs â—ƒ ys)
      â‡’â… ys := head xs â—ƒ ys â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ© 
        reverse xsâ‚€ = reverse (tail xs) âŒ¢ ys
      â‡’â… xs := tail xs â†âŸ¨ â€œAssignmentâ€ with Substitution âŸ© 
        reverse xsâ‚€ = reverse xs âŒ¢ ys                           â•â•â• Invariant holds
    âŸ©
    Â¬ (xs â‰  ğœ–) âˆ§ reverse xsâ‚€ = reverse xs âŒ¢ ys
  â‰¡âŸ¨ â€œDefinition of â‰ â€, â€œDouble negationâ€âŸ©  
    xs = ğœ– âˆ§ reverse xsâ‚€ = reverse xs âŒ¢ ys
  â‰¡âŸ¨ Substitution, â€œReplacementâ€âŸ©
    xs = ğœ– âˆ§ (reverse xsâ‚€ = reverse z âŒ¢ ys) [z â‰” ğœ–]
  â‰¡âŸ¨ Substitution âŸ©
    xs = ğœ– âˆ§ (reverse xsâ‚€ = reverse ğœ– âŒ¢ ys)
  â‰¡âŸ¨ â€œDefinition of `reverse` for ğœ–â€, â€œLeft-identity of âŒ¢â€âŸ©
    xs = ğœ– âˆ§ (reverse xsâ‚€ = ys)
  â‡’âŸ¨ â€œWeakeningâ€, â€œReflexivity of =â€âŸ©
    ys = reverse xsâ‚€  
       

Theorem â€œCorrectness of `rev`â€: xs = xsâ‚€ â‡’â… (ys := ğœ– â® while (xs â‰  ğœ–) do (ys := head xs â—ƒ ys â® xs := tail xs) od) â† ys = reverse xsâ‚€
Proof:
    Calculation for expected goal  `xs = xsâ‚€ â‡’â… (ys := ğœ– â® while (xs â‰  ğœ–) do (ys := head xs â—ƒ ys â® xs := tail xs) od) â† ys = reverse xsâ‚€`:
            xs = xsâ‚€
        â‡’ âŸ¨ â€œReverse Equalityâ€ âŸ©
                â€” CalcCheck: Found â€œReverse Equalityâ€
                â€” CalcCheck: â”€ OK
            reverse xs = reverse xsâ‚€
        â‰¡ âŸ¨ â€œReflexivity of =â€, â€œRight-identity of âŒ¢â€ âŸ©
                â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                â€” CalcCheck: Found (13.19) â€œRight-identity of âŒ¢â€
                â€” CalcCheck: â”€ OK
            reverse xsâ‚€ = reverse xs âŒ¢ ğœ–
        â‡’â… ys := ğœ– â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                â€” CalcCheck: â”€ OK
            reverse xsâ‚€ = reverse xs âŒ¢ ys
        â‡’â… while (xs â‰  ğœ–) do (ys := head xs â—ƒ ys â® xs := tail xs) od â† âŸ¨ â€œWhileâ€ with Subproof establishing `xs â‰  ğœ– âˆ§ reverse xsâ‚€ = reverse xs âŒ¢ ys â‡’â… (ys := head xs â—ƒ ys â® xs := tail xs) â† reverse xsâ‚€ = reverse xs âŒ¢ ys`:
                    xs â‰  ğœ– âˆ§ reverse xsâ‚€ = reverse xs âŒ¢ ys
                â‰¡ âŸ¨ â€œNon-empty-sequence decompositionâ€ âŸ©
                        â€” CalcCheck: Found â€œNon-empty-sequence decompositionâ€
                        â€” CalcCheck: â”€ OK
                    xs = head xs â—ƒ tail xs âˆ§ reverse xsâ‚€ = reverse xs âŒ¢ ys
                â‰¡ âŸ¨ Substitution, â€œReplacementâ€ âŸ©
                        â€” CalcCheck: Found (3.84b) â€œReplacementâ€, (3.84a) â€œReplacementâ€, (3.84c) â€œReplacementâ€, (3.51) â€œReplacementâ€
                        â€” CalcCheck: â”€ OK
                    xs = head xs â—ƒ tail xs âˆ§ (reverse xsâ‚€ = reverse z âŒ¢ ys)[z â‰” head xs â—ƒ tail xs]
                â‰¡ âŸ¨ Substitution âŸ©
                        â€” CalcCheck: â”€ OK
                    xs = head xs â—ƒ tail xs âˆ§ reverse xsâ‚€ = reverse (head xs â—ƒ tail xs) âŒ¢ ys
                â‡’ âŸ¨ â€œWeakeningâ€ âŸ©
                        â€” CalcCheck: Found (3.76e) â€œWeakeningâ€, (3.76d) â€œWeakeningâ€, (3.76a) â€œWeakeningâ€, (3.76b) â€œWeakeningâ€, (3.76c) â€œWeakeningâ€, â€œWeakeningâ€
                        â€” CalcCheck: â”€ OK
                    reverse xsâ‚€ = reverse (head xs â—ƒ tail xs) âŒ¢ ys
                â‰¡ âŸ¨ â€œDefinition of `reverse` for â—ƒâ€ âŸ©
                        â€” CalcCheck: Found â€œDefinition of `reverse` for â—ƒâ€
                        â€” CalcCheck: â”€ OK
                    reverse xsâ‚€ = (reverse (tail xs) â–¹ head xs) âŒ¢ ys
                â‰¡ âŸ¨ â€œMutual associativity of âŒ¢ with â–¹â€ âŸ©
                        â€” CalcCheck: Found â€œMutual associativity of âŒ¢ with â–¹â€
                        â€” CalcCheck: â”€ OK
                    reverse xsâ‚€ = reverse (tail xs) âŒ¢ (head xs â—ƒ ys)
                â‡’â… ys := head xs â—ƒ ys â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                        â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                        â€” CalcCheck: â”€ OK
                    reverse xsâ‚€ = reverse (tail xs) âŒ¢ ys
                â‡’â… xs := tail xs â† âŸ¨ â€œAssignmentâ€ with Substitution âŸ©
                        â€” CalcCheck: Found â€œAssignmentâ€, â€œAssignmentâ€
                        â€” CalcCheck: â”€ OK
                    reverse xsâ‚€ = reverse xs âŒ¢ ys            
            â€” CalcCheck: All steps OK
            âŸ©
                â€” CalcCheck: Found â€œWhileâ€
                â€” CalcCheck: â”€ OK
            Â¬ (xs â‰  ğœ–) âˆ§ reverse xsâ‚€ = reverse xs âŒ¢ ys
        â‰¡ âŸ¨ â€œDefinition of â‰ â€, â€œDouble negationâ€ âŸ©
                â€” CalcCheck: Found â€œDefinition of â‰ â€, â€œDefinition of â‰ â€
                â€” CalcCheck: Found (3.12) â€œDouble negationâ€
                â€” CalcCheck: â”€ OK
            xs = ğœ– âˆ§ reverse xsâ‚€ = reverse xs âŒ¢ ys
        â‰¡ âŸ¨ Substitution, â€œReplacementâ€ âŸ©
                â€” CalcCheck: Found (3.84b) â€œReplacementâ€, (3.84a) â€œReplacementâ€, (3.84c) â€œReplacementâ€, (3.51) â€œReplacementâ€
                â€” CalcCheck: â”€ OK
            xs = ğœ– âˆ§ (reverse xsâ‚€ = reverse z âŒ¢ ys)[z â‰” ğœ–]
        â‰¡ âŸ¨ Substitution âŸ©
                â€” CalcCheck: â”€ OK
            xs = ğœ– âˆ§ reverse xsâ‚€ = reverse ğœ– âŒ¢ ys
        â‰¡ âŸ¨ â€œDefinition of `reverse` for ğœ–â€, â€œLeft-identity of âŒ¢â€ âŸ©
                â€” CalcCheck: Found â€œDefinition of `reverse` for ğœ–â€
                â€” CalcCheck: Found (13.17) â€œLeft-identity of âŒ¢â€
                â€” CalcCheck: â”€ OK
            xs = ğœ– âˆ§ reverse xsâ‚€ = ys
        â‡’ âŸ¨ â€œWeakeningâ€, â€œReflexivity of =â€ âŸ©
                â€” CalcCheck: Found (3.76e) â€œWeakeningâ€, (3.76d) â€œWeakeningâ€, (3.76a) â€œWeakeningâ€, (3.76b) â€œWeakeningâ€, (3.76c) â€œWeakeningâ€, â€œWeakeningâ€
                â€” CalcCheck: Found (1.2) â€œReflexivity of =â€
                â€” CalcCheck: â”€ OK
            ys = reverse xsâ‚€    
    â€” CalcCheck: All steps OK   
    â€” CalcCheck: Calculation matches goal â”€ OK